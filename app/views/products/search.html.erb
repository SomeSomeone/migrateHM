 <% content_for :title do 'Результаты поиска товаров H+M' end %>
<main role="main" class="responsive segments">
  <!-- Main -->
  <!--AEMPUBPRDEU30-->
    <div class="breadcrumb">

      <nav class="breadcrumbs">
        <!-- Breadcrumbs -->
        <ul>
          <li><a href="#">YourHM</a></li>
          <li>Результаты поиска</li>
        </ul>
      </nav>
      <!-- /Breadcrumbs -->
    </div>

    <div class="layout">
      <section class="sidebarpluscontent modules ladies-flex">
        <div class="parsys main" style="width: 100%;">
          <div class="heading parbase section text">
            <h1 class="max-320-pad-search">ПОКАЗАНЫ РЕЗУЛЬТАТЫ ДЛЯ "<%=@search%>"</h1>
          </div>
          <div class="productlisting parbase section">
            <!--PAGE:productListing -->
            <div class="catalogwarning parbase"></div>
            <!-- Product filters -->
            <!-- <div class="row">
              <div class="product-filters sticky-on-scroll" data-sticky-width="100%" data-sticky-stop-offset="25" data-sticky-fill="true" style="">
                <div class="row">
                  <div class="totop">
                    <a href="#" class="toptrigger">Вернуться наверх</a>
                    <a href="#" class="filterlogo">Вернуться к началу</a>
                  </div>
                  <div class="filteractions clearfix">
                    <ul class="triggers clearfix">
                      <li class="js-clickexpand clickexpand filter " data-expandoptions="{&quot;toggle&quot;:&quot;true&quot;}">
                        <a href="javascript:;" class="trigger js-expandtrigger"> <strong>Фильтр</strong>
                        </a>
                        <div class="expandtarget js-expandtarget filters">
                          <form class="js-product-list-filter-form ng-pristine ng-valid" method="get" data-productlist-page="true" data-filtered-products-url="/products">
                            <div class="row">
                              <div class="cols clearfix">
                                <div class="col">
                                  <h4>Цвет</h4>
                                  <ul class="inputlist grid" data-filter-param-name="colorWithNames[]">
                                  <% @PossibleColors.each do |c|%>
                                        <li>
                                          <a href="/bodies" title="<%= c.name %>" class="filter-option <% if @ChoizenColor.include?(c.name) %> active <% end %>" data-value="<%= c.name %>">
                                            <span class="pattern" style="background:#000000;"></span>
                                            <%= c.name %>
                                          </a>
                                        </li>
                                    <% end %>
                                  </ul>
                                </div>

                                <div class="col">
                                  <h4>Размер</h4>
                                  <ul class="inputlist row-cols">
                                    <% @PossibleSizes.each_with_index do |c, k|%>
                                      <li class="row-col" data-r-s="r<%= c.size %>">
                                        <ul data-filter-param-name="sizes[]" class="inputlist rows">
                                          <li>
                                            <label for="filter-size-<%= c.size %>">
                                              <input id="filter-size-<%= c.size %>" type="checkbox" value="<%= c.size %>" <% if @ChoizenSize.include?(c.size) %> checked="checked" <% end %>>
                                              <div class="detailbox detailbox-value">
                                                <span><%= c.size %></span>
                                              </div>
                                            </label>
                                          </li>
                                        </ul>
                                      </li>
                                    <% end %>
                                  </ul>
                                </div>
                              </div>
                            </div>

                            <div class="row clearfilters button-rage">
                              <button class="button button-secondary js-filters-clear" disabled="disabled">СБРОСИТЬ ФИЛЬТР</button>
                              <a class="button js-filters-close" href="javascript:;">ПРИМЕНИТЬ ФИЛЬТР</a>
                            </div>
                        </div>
                      </li>
                                            <li class="js-clickexpand clickexpand sort-by " data-expandoptions="jkjkj">
                        <a href="javascript:;" class="trigger js-expandtrigger">
                          <strong>Сортировать</strong>
                        </a>
                        <div class="expandtarget js-expandtarget sort">
                          <ul class="menu toggleCurrent">
                            <li class="menu-sub-item current">
                              <a data-filter-param-name="sort" class="menu-link js-filters-close" data-value="best" >Лучшее</a>
                            </li>
                            <li class="menu-sub-item">
                              <a data-filter-param-name="sort" class="menu-link js-filters-close" data-value="PriceAsc" >Самая низкая цена</a>
                            </li>
                            <li class="menu-sub-item">
                              <a data-filter-param-name="sort" class="menu-link js-filters-close" data-value="PriceDesc" >Самая высокая цена</a>
                            </li>
                          </ul>
                        </div>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div> -->
            <!-- /Product filters -->
            <div class="row">
              <div class="model-and-product-switch">
                <div class="grid col-6 max-320-pad-search">
                  <ul>
                    <li class="right">
                      <span class="filterinfo">
                        <strong>ОТОБРАЖАЕТСЯ</strong>
                        <span class="load-count"><%= @products.size %></span>
                        из
                        <span class="total-counts"><%= @productsAll.size %></span>
                        товаров
                      </span>
                    </li>
                  </ul>
                </div>
                <!-- <div class="grid col-3 filter-group toggle-images">
                  <ul>
                    <li>
                      <a id="color_filter_model" href="#" data-value="model" class="">Модель</a>
                    </li>
                    <li>
                      <a id="color_filter_stillLife" href="#" data-value="stillLife" class="selected">Изделие</a>
                    </li>
                  </ul>
                </div> -->
              </div>
            </div>
            <div class="product-items-wrapper clearfix" data-articlecode="#">
               <section class="product-items big productlist-row">
                  <div class="product-items-content">
                    <div class="row flex-devil">
                    <%@products.each do |product| %>
                    <!-- Product item -->
                          <div class="grid col-3">
                            <article class="product-item club-price-item" style="position: relative;">
                              <%= link_to product.get_src , class: "product-item-link" do %>
                                
                                <img src="<%= product.img(:original) %>" alt="<%= product.name %>" width="222" height="333" class="product-item-image" data-altimage="<%= product.img_alt(:original) %>">
                                <% end %>
                                <button type="button" style="z-index: 2;" class="favorite icon icon-favorites js-favorite" data-tracking-type="event" data-saved-text="СОХРАНЕНО КАК ИЗБРАННОЕ" data-not-saved-text="СОХРАНИТЬ КАК ИЗБРАННОЕ" data-id="<%= product.product_datum[0].id %>" data-article="<%= product.product_datum[0].article %>">СОХРАНИТЬ КАК ИЗБРАННОЕ</button>
                              <div class="product-item-details">
                                <h3 class="product-item-heading">
                                  <%= link_to product.get_src do %>
                                  <%=product.name%>
                                  <% end %>
                                </h3>
                              <% if product.product_datum[0]!=nil and product.product_datum[0].price!=nil %>
                                <%if product.product_datum[0].promotional_price? %>
                                  <strong class="price sale-price"> <%=product.product_datum[0].get_promotional_price%> грн
                                    <span class="price original-price"><%= product.product_datum[0].get_price%> грн</span>
                                  </strong>
                                <%else%>
                                <strong class="price"><%= product.product_datum[0].get_price%> грн</strong>
                                <%end%>
                              <%else%>
                                <strong class="price">Уточняеться</strong>
                              <% end %>
                                <ul class="list-swatches">
                                 <%product.color.each do |c|  %>
                                  <li class="item">
                                    <%=image_tag(c.img(:original) ,class:"swatch")%>
                                  </li>
                                 <%end%>
                                </ul>
                              </div>
                            </article>
                          </div>
                    <!-- /Product item -->
                    <%end%>
                    </div>
                    </div>
                    </section>
                  <%= will_paginate @products, :previous_label => 'Назад', :next_label => 'Далее' %>

              <!-- /Product items -->
              <a href="#" class="hidden listing-total-count" data-total-count="66"></a>
            </div>
            <a class="load-more-link button infinite-scroll" href="#">Загрузить еще изделия</a>
            <div class="clearfix"></div>
          </div>
        </div>
      </section>
    </div>
    <div class="parbase overlaycontainer"></div>
  </main>
  <% content_for :javascript do %>
  <script>
  $(document).ready(function(){
    // $('.js-clickexpand').click(function(){
    //   $(this).find('.expandtarget').toggle();
    // });

  });
  $(document).ready(function(){
      // $('.favorite').click(function(){
      //   var a = $(this).attr('data-id');
      //   console.log('click');
      //     $.get("/addtofavorite/"+a, function(data) {
      //       console.log(data);
      //     });
      //   });
      itemss = JSON.parse(localStorage.getItem('myKey'));
      if(itemss)
        $('.favorite').each(function(){
          var btn = $(this).attr('data-article');
          $.each(itemss, function(){
            if(this.article == btn){
              $('.favorite[data-article="' + btn + '"]').addClass('is-favorite');
            }
          });
        });
      function showMessage(item_article) {
        itemss = JSON.parse(localStorage.getItem('myKey'));
        if(itemss)
          $.each(itemss, function(){
            if(this.article == item_article){
              $('.favorite[data-article="' + item_article + '"]').addClass('is-favorite');
            }
          });
      }
      function addToFav(item_id, item_article){
        $.get("/get?id="+ item_id, function(data) {
          a = data;
          a['size'] = 0;
          a['id'] = item_id;
          a['count'] = 0;
          items = JSON.parse(localStorage.getItem('myKey')) || [];
          items.push(a);
          localStorage.setItem('myKey', JSON.stringify(items));
          showMessage(item_article);
        });
      }

      $('.favorite').click(function(){
        itemss = JSON.parse(localStorage.getItem('myKey'))||[];
        var status = true;
        var this_article = $(this).attr('data-article');
        var this_id = $(this).attr('data-id');
        $.each(itemss, function(index){
          if(this.article == this_article){
            $('.favorite[data-article="' + this_article + '"]').removeClass('is-favorite');
            itemss.splice(index, 1);
            localStorage.setItem('myKey', JSON.stringify(itemss));
            status=false
          }
        });
        if(status){
          addToFav(this_id, this_article);
        }
      });
        itemss = JSON.parse(localStorage.getItem('myKey'));
        console.log(itemss);
    });
      // $(document).ready(function(){
      //   function addToFav(a){
      //   console.log('click');
      //     $.post("/addtofavorite/1", function(data) {
      //       console.log(data);
      //       // $('.nice-pop-block').html("<div class='nice-pop-close'></div><p class='after_subm'>Спасибо, Ваша заявка отправлена</p>");
      //         // console.log($(data).submit());
      //     });
      //   }
      // });

      //colorWithNames size sort
      $(document).ready(function(){
        $("html").on("click" , "*[data-filter-param-name]" , function () {
          url=window.location.href.split('?')[0];
          helper=false
          $(this).toggleClass("active")
          $("input[data-filter-param-name]").each(function(index) {
            if($(this).prop( "checked" )){
              helper? url+="&":url+="?"
              url+=$(this).attr("data-filter-param-name")+"="+$(this).val()
              helper=true
            }
          })
          $("a[data-filter-param-name]").each(function(index) {
            if($(this).hasClass( "active" )){
              helper? url+="&":url+="?"
              url+=$(this).attr("data-filter-param-name")+"="+$(this).attr('data-value')
              helper=true
            }
          })

          $(".js-filters-close").attr("href" , url)
        })
      $(".ladies-side-bar-label").click(function(){
        $(".ladies-side-bar").toggleClass("active");
        $(".ladies-side-bar-label").toggleClass("active");
        $(".mini-menu").toggleClass("delete");
      });
      $(".side-bar-cross").click(function(){
        $(".ladies-side-bar").toggleClass("active");
        $(".ladies-side-bar-label").toggleClass("active");
        $(".mini-menu").toggleClass("delete");
      });
      $('.js-clickexpand').click(function(){
        $(this).find('.expandtarget').toggle();
      });
      // altimg
      $('.product-item-link').hover(
        function(){
          if($(this).find('img').attr('src') != ''){
            var main_img = $(this).find('img').attr('src');
            var alt_img = $(this).find('img').attr('data-altimage');
            $(this).find('img').attr('src', alt_img);
            $(this).find('img').attr('data-altimage', main_img);
          }
        },
        function(){
          var alt_img = $(this).find('img').attr('src');
          var main_img = $(this).find('img').attr('data-altimage');
          $(this).find('img').attr('src', main_img);
          $(this).find('img').attr('data-altimage', alt_img);
        }
      );
      // end
    })
    </script>
  <% end %>

