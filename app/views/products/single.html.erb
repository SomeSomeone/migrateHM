
<% if @product %>
  <% content_for :title do "#{@product.name}. #{@color_active.name} — Купить в интернет магазине H+M " end %>
  <% content_for :description do @product_data.about||"Купить #{@product.name} в интернет магазине H+M. Покупайте #{@product.name} — #{@color_active.name} по низкой цене. Доставка по Украине" end%>
<%end%>



<%if @admin%>
	<%= link_to 'Редактировать', admin_product_edit_path(@product) %>
<% end %>
<main role="main">
	<!-- Main -->
	<div class="wrapper">
		<div class="product parbase">
			<!--PAGE:productDetail -->
			<div class="catalogwarning parbase">
			<script>
				 var productArticleDetails = {
  'alternate': '\u0412\u044F\u0437\u0430\u043D\u044B\u0439 \u043A\u0430\u0440\u0434\u0438\u0433\u0430\u043D - {alternatecolor} - Женщины | H&M RU', 
    'articleCode':'0129393047', 'baseProductCode' : '0129393_group_042_047', 'categoryParentKey' : '/1/ladies',
    
    'styleWithArticles' : [
      
          '0510152001',
      
          '0228257002',
      
          '0469513001',
      
          '0377144014',
      
          '0452689002',
      
          '0466250001',
      
          '0451703001',
      
          '0481645001',
      
          '0286825010',
      
          '0270381003'
      
    ],
    
    
    // 
    <% @product_datas.each do |product_data| %>
    '<%= product_data.article %>0000': {
      'name': 'Черный',
      'colorCode': '09',  
      'selection': false,
      'description': '<%= product_data.about%>',
      'images':[
          
          <% product_data.photos.each do  |photo|  %>
          {
          'thumbnail': '<%= photo.img.url(:thumbnail) %>',
          'image': '<%= photo.img.url(:medium) %> ',
          'zoom': '<%= photo.img.url(:original) %>'
          },
          <%end%>
          
      ],
      
      
        
        
          'price': '<%= product_data.get_price %> грн',
          'priceOriginal': false,
          'priceValue': '<%= product_data.get_price %> ',
          'priceSaleValue': null,
        
      
      
      
              
        
          'promoMarkerIcon': '',
              'priceClub': null,
              
                    'promoMarkerUrl': '//www2.hm.com/medias/3for2-RU.png?context=bWFzdGVyfHJvb3R8MzA4OHxpbWFnZS9wbmd8aDRlL2hjZi8xMDQ0Mzk1MDI2MDI1NC5wbmd8OGNmNjZlMWEwMzhkN2I0YzkzMDg1ZGM3OTU0MzA0M2FhZTg3NTc0ZGMwMGJhYTNiMzAyNDQ3ZTY2NjkxN2IxYg',
            'promoMarkerAlt': '',
                    'promoMarkerLegalText': '\u042D\u0442\u043E \u043F\u0440\u0435\u0434\u043B\u043E\u0436\u0435\u043D\u0438\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0443\u0435\u0442 \u043D\u0430 \u0441\u0430\u0439\u0442\u0435 hm.com \u0434\u043E 05.04.2017 \u0438\u043B\u0438 \u0434\u043E \u0442\u0435\u0445 \u043F\u043E\u0440, \u043F\u043E\u043A\u0430 \u0442\u043E\u0432\u0430\u0440\u044B \u0435\u0441\u0442\u044C \u0432 \u043D\u0430\u043B\u0438\u0447\u0438\u0438',
                    'promoMarkerLabelText': '',
          
        
      
      
      
      
      
      'composition': [
        
          '\u0410\u043A\u0440\u0438\u043B 50%; \u0412\u0438\u0441\u043A\u043E\u0437\u0430 50%'
        
        ],
      
      
      'careInstructions': [
          
              '\u041C\u0430\u0448\u0438\u043D\u043D\u0430\u044F \u0441\u0442\u0438\u0440\u043A\u0430 \u043F\u0440\u0438 \u0442\u0435\u043C\u043F\u0435\u0440\u0430\u0442\u0443\u0440\u0435 40\u00B0'
          
            ],
      
      
      
      'url': '/single/hm-<%= product_data.article %>'
      
    },
    <%end%>
  };
</script>
			</div>
			<div class="row product-detail">
				<div class="images parbase max-single-width">
					<section class="product-detail-images grid col-6 clearfix">
						<button class="product-detail-thumbnails-scroll-up disabled">
							<div class="navigation-arrow-up"></div>
						</button>
						<div class="product-detail-thumbnails">
							<ul>
								
								<% @product_data.photos.reverse.each do  |photo|  %>
								<li class="product-detail-thumbnail">
									<%=image_tag(photo.img(:thumbnail),
									 alt:@product.name ,class:"swatch",
									  datalarge:(photo.img(:medium)),
									  imglarge:(photo.img(:original)||photo.img(:medium)))%>
								</li>
								<%end%>
								
							</ul>
						</div>
						<button class="product-detail-thumbnails-scroll-down disabled">
							<div class="navigation-arrow-down"></div>
						</button>
						<div class="product-detail-main-image">
							<% if @product_data.photos[0] %>
								<div class="product-detail-main-image-container">
	                				<%=image_tag(@product_data.photos[-1].img(:medium),
	                				 alt:@product.name ,
	                				 class:"swatch",
	                				  imglarge: @product_data.photos[-1].img(:original)||@product_data.photos[-1].img(:medium))%>

								</div>
							<%end%>
							<span class="product-detail-zoom-info">Нажмите на изображение, чтобы изменить его размер</span>
							<span class="product-detail-zoom-info touch-info">Коснуться изображения, чтобы развернуть его на весь экран</span>
						</div>
					</section>
				</div>
				<section class="product-detail-meta grid col-6 single-adapt">
					<div class="product-detail-options">
						<h1 class="product-item-headline"><%= @product.name%></h1>
						<div class="price parbase">
							<%if @product_data.promotional_price? %>
								<div class="product-item-price product-item-price-discount">
									<span class="price-value"><%= @product_data.get_promotional_price%> грн</span>
									<small class="price-value-original"><%= @product_data.get_price%> грн</small>
								</div>
							<%else%>
								<div class="product-item-price">
									<span class="price-value"><%= @product_data.get_price%> грн</span>
								</div>
							<%end%>
						</div>
						<div class="product-item-selection hidden"></div>
						<div id="swatchsize">
							<% if @color_active || @colors !=[]%>
								<div class="product-colors clearfix loaded">
									<% if @color_active%>
									<div class="product-input-label" data-value="">
										Цвет:
										<span><%= @color_active.name %></span>
									</div>
									<%end%>
									<ul class="inputlist clearfix">
										<% @product_datas.each do |product_data| %>
											<li>
												<% if @color_active==product_data.color %>
													<a href="/single/hm-<%= product_data.article %>" title="<%= product_data.color.name %>" data-sizes="" data-articlecode="<%= product_data.article %>0000" id="filter-colour-<%= product_data.article %>" class="filter-option active">
												<% else %>
													<a href="/single/hm-<%= product_data.article %>" title="<%= product_data.color.name %>" data-sizes="" data-articlecode="<%= product_data.article %>0000" id="filter-colour-<%= product_data.article %>" class="filter-option ">
												<%end%>
		    					                <%=image_tag(product_data.color.img(:original), alt:product_data.color.name,class:"pattern")%></a>
											</li>
										<%end%>
										</li>
									</ul>
								</div>
							<%end%>
							<div class="product-sizes loaded">
								<div class="product-input-label" data-value="Выбрать размер" data-default-value="Select size">
									Размер:
									<span>Выберите размер</span>
								</div>
								<% @product_datas.each do |product_data| %>
									<ul class="inputlist clearfix" data-sizelist="<%= product_data.article %>0000">
										<% if @product_sizes %>
											<% @product_sizes.each_with_index do |product_product_size, k| %>
												<li class="one_size">
													<label class="filter-size" id="<%= product_product_size.product_size.size.gsub(/[" "]/, "").gsub(/["+"]/, "_") %>" for="filter-size-<%= product_data.article %>00<%= k %>">
														<input type="radio" name="product-size" value="<%= product_product_size.product_size.size %>" data-size="001" id="filter-size-<%= product_data.article %>00<%= k %>" <%if ! product_product_size.has%> disabled <% end %>>
														<%if product_product_size.has%>
														<div class="detailbox detailbox-value">
															<span><%= product_product_size.product_size.size %></span>
														</div>
														<%else%>
														<div class="detailbox detailbox-value unavailable">
															<span><%= product_product_size.product_size.size %></span>
														</div>
														<%end%>
													</label>
												</li>
											<%end%>
										<%end%>
									</ul>
								<%end%>
								<div class="product-detail-linked-product">
									<a href="javascript:void(0)" class="underline overlay-trigger open">Руководство по размерам</a><br>
									<!-- <a href="javascript:void(0)" class="underline overlay-trigger">Онлайн помощь по подбору размера</a> -->
								</div>
							</div>
						</div>
					</div>
					<div class="product-detail-details">
						<div class="product-detail-availability">
							Доставка 7-10 рабочих дней. Стоимость доставки согласно тарифам Новой Почты. При заказе от 1000 грн доставка по Украине БЕСПЛАТНО.
						</div>
						<div class="product-detail-availability">
							У нас вы можете приобрести:
							<% coma = false %>
							<% @product.get_cat.each do |cat|%>
								<% c = cat %>
								<% f = '' %>
								<%= "," if coma%>
								<a href="/products<% while (c!=nil) %>
									<% f='/'+c.url+f%>
									<% c = c.parent %>
									<% coma = true %>
								<%end%>
								<%=f%>"

								><%= cat.name %></a>



							<%end%>
						</div>
						<button class="button button-big button-buy product-details-favorite button-disabled" data-not-added-text="Вы должны выбрать имеющийся в наличии размер" data-added-text="Товар добавлен" data-shopping-bag-text="Корзина" data-shopping-bag-failed-text="При добавлении товара в корзину произошла ошибка" data-quantity-text="Количество" data-color-text="Цвет" data-size-text="Размер" data-default-quantity="1" data-sold-out-text="Распродано" data-not-added-sold-out-text="Изделие данного цвета распродано во всех размерах">Добавить в корзину</button>

<!-- 						<button class="button button-big button-secondary button-favorite icon icon-favorites-dark js-button-favorite is-favorite">СОХРАНЕНО КАК ИЗБРАННОЕ</button> -->

						<button class="button button-big button-secondary button-favorite icon icon-favorites-dark js-button-favorite" data-id="<%= @product_data.id %>">СОХРАНИТЬ КАК ИЗБРАННОЕ</button>

						<div class="parbase details">
							<div class="product-detail-tabs tabs">
								<ul class="tab-items">
									<li class="tab-item">
										<a href="javascript:;" class="tab-item-link active" data-target="tab-description">Описание</a>
									</li>
									<li class="tab-item">
										<a href="javascript:;" class="tab-item-link" data-target="tab-details">Подробнее</a>
									</li>
									<li class="tab-item">
										<a href="javascript:;" class="tab-item-link" data-target="tab-delivery">Доставка</a>
									</li>
								</ul>
								<div class="tab-pane tab-description active">
									<p class="product-detail-description-text" itemprop="description">
										<%= @product_data.about%>
									</p>
									<ul class="product-warninglist" data-headline-text="ПРЕДУПРЕЖДЕНИЕ!"></ul>
								</div>
								<div class="tab-pane tab-details">
									<%=@product_data.more.html_safe %>
								</div>

								<div class="tab-pane tab-delivery">
									<p>
										В зависимости от того, где вы проживаете, Вам доставят Ваш заказ в срок от 7 до 14 рабочих дней после того, как Вы получите подтверждение на Ваш адрес электронной почты. В период высокого спроса и распродаж, возможно, доставка займет больше времени. Вы сможете оплатить Ваш заказ онлайн через приват 24 или получить реквизиты для оплаты в терминале или отделении банка. Стоимость доставки заказа по Украине определяется тарифами Новой почты. При заказе а сумму, превышающую 1000 грн, затраты на доставку мы берем на себя.
									</p>
								</div>
							</div>
						</div>
					</div>
				</section>
			</div>
		</div>


		<div class="praone parbase productrecommendationarea">
			<!-- PRA 1 -->
			<section class="product-recommendation-area product-items items-6 ng-scope">
				<header>
					<h2 class="product-recommendation-area-title ng-binding">Также покупают</h2>
				</header>
				<div class="product-items-content">
					<div class="row swipe swipe-single wid-100" style="visibility: visible;">
						<ul class="swipe-items wid-100">
							<!-- ngRepeat: list in praCtrl.pra1Panel.products -->
							<li class="swipe-item ng-scope flex-single" data-index="0">
								<!-- ngRepeat: product in list -->
								<% @products.each do |p| %>
									<% if p.product_datum[0] %>
										<div class="grid col-2 ng-scope" ng-repeat="product in list">
											<article class="product-item club-price-item">
												<%= link_to "/single/hm-#{p.product_datum[0].article}" , class: "product-item-link" do %>
		                      						<%=image_tag(p.img(:original) , width:"140", height:"210", class:"product-item-image", alt:p.name)%>
													<button type="button" class="favorite icon icon-favorites js-favorite"></button>
												<%end%>
												<div class="product-item-details">
													<h3 class="product-item-headline">
														<a class="ng-binding" href="/single/hm-<%=p.product_datum[0].article%>"><%=p.name%></a>
													</h3>
														<% if p.product_datum[0]!=nil and p.product_datum[0].price!=nil %>
															<%if p.product_datum[0].promotional_price?%>
																<strong class="price sale-price"> <%=p.product_datum[0].get_promotional_price%> грн
																	<span class="price original-price"><%= p.product_datum[0].get_price%> грн</span>
																</strong>
															<%else%>
															<strong class="price"><%= p.product_datum[0].get_price%> грн</strong>
															<%end%>
														<%else%>
															<strong class="price">Уточняеться</strong>
														<% end %>
														<span class="price original-price ng-binding"></span>
													<ul class="list-swatches">
														<!-- ngRepeat: color in product.variantData -->

														<%p.color.each do |c|  %>
															<li ng-repeat="color in product.variantData" class="item ng-scope" add-space="">
																<%=image_tag(c.img(:original) ,class:"swatch")%>
															</li>
														<%end%>

														
														<!-- end ngRepeat: color in product.variantData -->
													</ul>
												</div>
											</article>
										</div>
									<%end%>
								<%end%>
							</li>
						</ul>
					</div>
				</div>
			</section>
		</div>
		<div class="parsys main"></div>
	</div>
</main>
<div class="modaloverlay responsive hidden">
	<div class="modalbackground"></div>
	<div class="modal fadeInModal" style="margin-top: 117px;">
		<button class="modalclose icon-close-black"></button>
		<%if @pop and @pop!=''%>
			<%=@pop.html_safe%>
		<%end%>
	</div>
</div>

<% content_for :javascript do %>
<script>
  // добавление в расперсенный json - items.la="llllll"
  // объединение 2-х объектов
  // a=[];
  // a.push(b);
  // a.push(items)
  $(document).ready(function(){
  	$('.button-favorite').click(function(){
  		// console.log('сохранить как избранное');
  		ga('send', 'event', 'Избранное', 'Добавление', 'Сохранить в избранное');
  	});
  	$('.detailbox-value').click(function(){
  		// console.log('нажатие на размер');
  		ga('send', 'event', 'Размер', 'Нажатие', 'Нажатие на размер');
  	});

	setTimeout(
	  	function () {
		  	$.ajax({
			  url: "/get_sizes/?id=<%=@product_data.id%>",
			  success: function(data){
			    $(".filter-size input").prop( "disabled", true );
			    $(".filter-size .detailbox").addClass("unavailable")
			    // console.log(data)
			    $(".price-value-original").remove()
			    if (data.promotional_price && data.promotional_price>0) {
			    	$(".product-item-price").addClass("product-item-price-discount")
			    	$(".price-value").text(data.promotional_price+" грн")
			    	$(".product-item-price").append('<small class="price-value-original">'+data.price+' грн</small>')
			    }else{
			    	$(".product-item-price.product-item-price-discount").removeClass("product-item-price-discount")
			    	$(".price-value").text(data.price+" грн")
			    }
			    $.each(data.sizes, function( index, value ) {
				  $((".filter-size#"+value.replace(/ /g, '').replace(/[+]/g, '_')+" input").replace(/[/]/g, '\\/')).prop( "disabled", false );
				  $((".filter-size#"+value.replace(/ /g, '').replace(/[+]/g, '_')+" .detailbox").replace(/[/]/g, '\\/')).removeClass("unavailable")
				});
			  }
			});
	  	},2000
	)
	setTimeout(
	  	function () {
		  	$.ajax({
			  url: "/get_sizes/?id=<%=@product_data.id%>",
			  success: function(data){
			    $(".filter-size input").prop( "disabled", true );
			    $(".filter-size .detailbox").addClass("unavailable")
			    // console.log(data)
			    $(".price-value-original").remove()
			    if (data.promotional_price && data.promotional_price>0) {
			    	$(".product-item-price").addClass("product-item-price-discount")
			    	$(".price-value").text(data.promotional_price+" грн")
			    	$(".product-item-price").append('<small class="price-value-original">'+data.price+' грн</small>')
			    }else{
			    	$(".product-item-price.product-item-price-discount").removeClass("product-item-price-discount")
			    	$(".price-value").text(data.price+" грн")
			    }
			    $.each(data.sizes, function( index, value ) {
				  $((".filter-size#"+value.replace(/ /g, '').replace(/[+]/g, '_')+" input").replace(/[/]/g, '\\/')).prop( "disabled", false );
				  $((".filter-size#"+value.replace(/ /g, '').replace(/[+]/g, '_')+" .detailbox").replace(/[/]/g, '\\/')).removeClass("unavailable")
				});
			  }
			});
	  	},4000
	)
	setTimeout(
	  	function () {
		  	$.ajax({
			  url: "/get_sizes/?id=<%=@product_data.id%>",
			  success: function(data){
			    $(".filter-size input").prop( "disabled", true );
			    $(".filter-size .detailbox").addClass("unavailable")
			    // console.log(data)
			    $(".price-value-original").remove()
			    if (data.promotional_price && data.promotional_price>0) {
			    	$(".product-item-price").addClass("product-item-price-discount")
			    	$(".price-value").text(data.promotional_price+" грн")
			    	$(".product-item-price").append('<small class="price-value-original">'+data.price+' грн</small>')
			    }else{
			    	$(".product-item-price.product-item-price-discount").removeClass("product-item-price-discount")
			    	$(".price-value").text(data.price+" грн")
			    }
			    $.each(data.sizes, function( index, value ) {
				  $((".filter-size#"+value.replace(/ /g, '').replace(/[+]/g, '_')+" input").replace(/[/]/g, '\\/')).prop( "disabled", false );
				  $((".filter-size#"+value.replace(/ /g, '').replace(/[+]/g, '_')+" .detailbox").replace(/[/]/g, '\\/')).removeClass("unavailable")
				});
			  }
			});
	  	},6000
	)

  	showMessage();
  	if($('input[name="product-size"]:checked').length > 0){
	  	disableButton();
	  }
    // // окно сайзгайда
    $('.product-detail-linked-product .open, .modalclose').click(function(){
    	// console.log('clicj');
    	$('.modaloverlay').toggleClass('hidden');
    });
    $('.toggle-list-item').click(function(){
    	$(this).find('.slide-down-toggle').toggleClass('open');
    });
    // // окно сайзгайда/
    // // описание
    $('.tab-item > a').click(function(){
    	$('.tab-item > a').removeClass('active');
    	$(this).addClass('active');
    	var i = $(this).parent().index();
    	$('.tab-pane').removeClass('active');
    	$('.tab-pane').eq(i).addClass('active');
    });
    // описание /
    function disableButton(){
	    $('.button-buy').removeClass('button-disabled');
    }

    $('.detailbox').click(function(){
    	disableButton();
    });

  	var color = $('.filter-option.active').attr('data-articlecode');
    $('.inputlist.clearfix[data-sizelist="' + color +'"]').show();

    // function cartCount(plus_one) {
    // 	cartCounts = JSON.parse(localStorage.getItem('cartCount'));
  		// cartCounts = cartCounts + plus_one;
  		// $('.shoppingbag-item-counts').text(cartCounts);
  		// localStorage.setItem('cartCount', JSON.stringify(cartCounts));
    // }


    function showMessage() {
    	itemss = JSON.parse(localStorage.getItem('myKey'));
    	if(itemss)
    		$.each(itemss, function(){
    			if(this.article == <%= @product_data.article %>){
    				$('.button-favorite').addClass('is-favorite').text('СОХРАНЕНО КАК ИЗБРАННОЕ');
    			}
    		});
		}
		function addToFav(){
			$.get("/get?id="+<%= @product_data.id %>, function(data) {
    		a = data;
    		a['size'] = 0;
    		a['id'] = <%= @product_data.id %>;
    		a['count'] = 0;
    		items = JSON.parse(localStorage.getItem('myKey')) || [];
    		items.push(a);
    		localStorage.setItem('myKey', JSON.stringify(items));
    		showMessage();
  		});
		}
    $('.button-favorite').click(function(){
    	itemss = JSON.parse(localStorage.getItem('myKey'))||[];
    	var status = true
  		$.each(itemss, function(index){
  			if(this.article == <%= @product_data.article %>){
  				$('.button-favorite').removeClass('is-favorite');
  				$('.button-favorite').text('СОХРАНИТЬ КАК ИЗБРАННОЕ')
  				itemss.splice(index, 1);
  				localStorage.setItem('myKey', JSON.stringify(itemss));
  				status=false
  			}
  		});
    	if(status){
    		addToFav();
    	}
    });


    function addToCart(size_val){
			$.get("/get?id="+<%= @product_data.id %>, function(data) {
    		a = data;
    		a['size'] = size_val;
    		a['id'] = <%= @product_data.id %>;
    		a['count'] = 1;
    		cart_mas = JSON.parse(localStorage.getItem('myCart')) || [];

    		$.each(cart_mas, function(index){
    			if(this.size == size_val && this.article == <%= @product_data.article %> ){
    				cart_mas.splice(index, 1);
		            localStorage.setItem('myCart', JSON.stringify(cart_mas));
		            count = this.count + 1;
	            		if(count >= 10){
	            			a['count'] = 10;
	            		}
	            		else{
	            			a['count'] = count;
	            		}
    			}
    		});
    		cart_mas.push(a);
    		localStorage.setItem('myCart', JSON.stringify(cart_mas));
    		cartCount();
  		});
		}
		$('.button-buy').click(function(){
			size_check = false;
			$('input[name="product-size"]').each(function(index){
				if($(this).prop('checked')){
					size_check = true;
					size_val = $(this).parent().find('.detailbox > span').text();
					addToCart(size_val);
				}
			});
			if(!size_check){
				alert($('.button-buy').attr('data-not-added-text'));
			}
			else{
				ga('send', 'event', 'Корзина', 'Добавление', 'Добавление в корзину');
				// console.log('добавление в корзину')
			}
		});
		// cartCount(0);
		// imgCarousel
		$('.product-detail-thumbnail img').click(function(){
			var new_img_medium = $(this).attr('datalarge');
			var new_img_large = $(this).attr('imglarge');
			$('.product-detail-main-image-container img').attr('src', new_img_medium);
			$('.product-detail-main-image-container img').attr('imglarge', new_img_large);
		});
		$('.product-detail-main-image-container').hover(function(){
			// $(this).zoom();
			// // $('.zoomImg').remove();
			// ga('send', 'event', 'Фото', 'Нажатие', 'Нажатие на фото');
			// console.log('нажатие на фото')
			var to_hover = $(this).find('img').attr('imglarge');
			$(this).find('img').attr('src', to_hover);
			$(this).zoom({ on:'click', magnify: 0.5});
		},
		function(){
			$(this).trigger('zoom.destroy');
		});

		// $('.zoomImg').click(function(){
		// 	$(this).remove();
		// });
  });
</script>
  <% end %>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Product",
  "description": "<%= @product_data.about%>",
  "name": "<%= @product.name%>",
  <% if (@product_datas[0] and @product_datas[0].photos[0] )%>
  "image": "<%= @product_datas[0].photos[0].img.url(:medium)%>",
  <% end %>
  "offers": {
    "@type": "Offer",
    "availability": "http://schema.org/InStock",
    "price": "<%= @product_data.promotional_price? ? @product_data.get_promotional_price : @product_data.get_price%>",
    "priceCurrency": "UAH"
  }
}

</script>